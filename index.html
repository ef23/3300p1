<html>

<head>
<title>INFO3300 Project 1</title>
<link href="https://fonts.googleapis.com/css?family=Share+Tech+Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300, 400,700,800|Space+Mono:400,400i,700" rel="stylesheet">

<style>
svg {display:block;margin:auto;/*border: solid #ccc 1px;*/}
img {display:block; margin: auto; padding-bottom: 5%}
h1 { font-family: 'Open Sans', sans-serif; font-weight: 800; letter-spacing: 4px; font-size: 50px; color: rgb(8,160,233); text-align:center; padding-top: 60px;}
h2 { font-family: 'Open Sans', sans-serif; font-weight: 300; font-size: 20px; text-align:center; color: 'rgb(40, 116, 166)';}
h4 { font-family: 'Open Sans', sans-serif; font-weight: 800; font-size: 24px; text-align:center; margin: 10 0 10 0;}
body { font-family: 'Space Mono: 400', monospace; /*margin: auto; */background-color:rgb(232,245,253)}
p {font-family: 'Open Sans', sans-serif; font-weight: 300; text-align:center;}
.axis { font: 14px Consolas; }
.header {padding-bottom: 50px;}
</style>

</head>
<body>
<div class="header">
  <h1 class="text-center"> TRUMP AND TWITTERING NEWS</h1>
  <h2>A look at Trump's Twitter relationship with (fake) news before and after his election <br></h2>
  <p>Team: Eric Feng, Erin Chen, Sohyeon Hwang</p>
</div>

<h4> TRUMP'S TWEETS SINCE HIS CAMPAIGN BEGAN</h4>
<div class="container-fluid">
  <div id="div1"></div>
  <h4>TWEETS CONTAINING CONTENT ABOUT MEDIA</h4>
  <div id="div2">
	<h2> media mentioned approx. <b>17%</b> consistently </h2>
	</div>
  <h4> MENTIONED NEWS OUTLETS OVER TIME </h4>
  <div id="div3">
	<h2> % cumulative mentions per news outlets in media-related tweets</h2>
	</div>
  <h4>HOW FAKE IS THE NEWS THIS MONTH? </h4>
  <div id="div4">
  <h2> % media-related tweets mentioning "fake news" </h2>
  </div>
  <h4>TRUMP'S FAKEST MEDIA</h4>
  <div id="div5">
  <h2> % tweets per news outlet associated with "fake news" </h2>
  </div>
  <img src="resources/trumptweet.png"/>
</div>
<script src="https://d3js.org/d3.v4.min.js"></script>

<!-- if the index.html gets too cumbersome, these are the individual js files: -->
<!--
<script src="js/vars.js"></script>
<script src="js/scatterplots.js"></script>
<script src="js/mediaData.js"></script>
<script src="js/stackedAreas.js"></script>
<script src="js/main.js"></script>
<script src="js/waffleGraph.js"></script>
-->
<script>
/***************** Various Variables Used Often  *******************/
// dimensions for the svgs
var width = 1100;
var height = 550;
var padding = 50;
var paddingSides = 200;
var paddingBottom = 150;
var linecolor = "orange";

// dates for the graph
var electionDay = new Date(2016, 10, 8);
var y2016 = new Date(2016, 0, 1);
var y2017 = new Date(2017, 0, 1);
var y2018 = new Date(2018, 0, 1);
var mindate = new Date(2015, 5, 15),
    maxdate = new Date(2018, 2, 1);

// keywords the tweet had to contain to be considered a "media" tweet
var media = ["cnn", "nbc", "msnbc", "washington post", "washingtonpost", "wapo", "nytimes", "new york times", "fox", "media", "press", "fake news", "fakenews", "news", "journal", "reporting"]

// draws the election line, as well as year lines, on graphs
function drawLines(svg, height, paddingBottom, xScale, scale, addElectionLabel) {
  var importantDates = [electionDay, y2016, y2017, y2018]
  var names = ["2016 Presidential Election", "2016", "2017", "2018"]
  var ids = ["#election","#y16", "#y17", "#y18"]
  importantDates.forEach(function(d, i){
    var isNotYear = isNaN(names[i]);
    var isElect = (names[i].includes("Election"));

    if (!addElectionLabel && names[i].includes("Election")) { return; }

    svg.append("text")
      .attr("x", xScale(d))
      .attr("y", height - paddingBottom)
      .attr("id",(isElect? "#election" : void(0)))
      .attr("text-anchor", "middle")
      .attr("font-weight", 800)
      .attr("font-size", (isNotYear ? 20 : 14) * scale)
      .text(names[i])
      .attr("transform", "translate(" + (isNotYear ? (isElect ? -10 : 60) : (isElect ? 0 : 0))*scale + "," + (isNotYear ? (isElect ? 82 : 60) : (isElect ? 0 : 20))*scale +  ")");
  })
}

// the x-scale used in all but the last graph, spanning 6/15/15 -> 2/1/18
var xScale = d3.scaleTime()
    .domain([mindate, maxdate])
    .range([paddingSides, width - paddingSides]);

/***************** Processing the media tweets   *******************/

var outlets = {"cnn": 0, "nbc":0, "washington post" : 0, "nytimes" : 0, "fox" :0 , "breitbart": 0}

var mediaData;

var cnnCount = 0;
var nbcCount = 0;
var wapoCount = 0;
var nytCount = 0;
var foxCount = 0;
var breitCount = 0;
var miscCount = 0;

var fakeNews = 0;
var notFake = 0;

var mediaCount = 0;
var notMediaCount = 0;

// organize outlets by month

/* Array Matrix function from : https://stackoverflow.com/questions/7545641/javascript-multidimensional-array

Courtesy of: The Good Parts (O'Reilly, p. 64) */

Array.matrix = function(numrows, numcols, initial) {
    var arr = [];
    for (var i = 0; i < numrows; ++i) {
        var columns = [];
        for (var j = 0; j < numcols; ++j) {
            columns[j] = initial;
        }
        arr[i] = columns;
    }
    return arr;
}

var month_outlet = Array.matrix(33, 7, 0);
var outlets = {"breitbart":0, "washingtonpost":1, "nyt":2, "nbc":3, "cnn":4, "fox":5, "misc":6};

function outletsByMonth(d) { // want to put in mediaData
  d.forEach(function(element) {
    var m = element.month;
    var outlet_l = element.outlet;
    outlet_l.forEach(function(element) {
      var o = outlets[element];
      month_outlet[m][o] += 1;
    })
  })
}

var month_fake = Array.matrix(33, 2, 0);
// fake news vs. news
function fakeness(d) { // want to put in mediaData
  d.forEach(function(element) {
    var m = element.month;
    var f = element.is_fakeNews;

    if (f == true) { // trumps says is fake
      month_fake[m][0] += 1;
    } else {
      month_fake[m][1] += 1;
    }
  })
}

// outlets / fake news
var month_fake_outlets = Array.matrix(33,7,0);
function fakeOutlets(d) {
    d.forEach(function(element) {
      var f = element.is_fakeNews;
      // console.log(f);
      if (f == true) {
        var m = element.month;
        // console.log(m);
        var outlet_l = element.outlet;
        outlet_l.forEach(function(x) {
          var o = outlets[x];
          month_fake_outlets[m][o] += 1;
        })
    }})
}

// not fake
var month_notfake_outlets = Array.matrix(33,7,0);
function notFakeOutlets(d) {
    d.forEach(function(element) {
      var f = element.is_fakeNews;
      // console.log(f);
      if (f == false) {
        var m = element.month;
        // console.log(m);
        var outlet_l = element.outlet;
        outlet_l.forEach(function(x) {
          var o = outlets[x];
          month_notfake_outlets[m][o] += 1;
        })
    }})
}

function intoPercentages(arrayName, slice) { // slice = last index value
  var monthsinPercent = [];
  for (var i = 0; i < 33; ++i) {
    var total = 0;
    m_array = arrayName[i].slice(0,slice);

    for (var ii in m_array) { // we have total of a month
      total += m_array[ii]
    }

    for(var iii in m_array) { // month to percent
      m_array[iii] = m_array[iii] / total
    }
    monthsinPercent.push(m_array);
}
return monthsinPercent;
}

function toCumulative(og_array) {
  var copyArray = og_array;
  var num_months = og_array.length;

  var currentCount = [0, 0, 0, 0, 0, 0];
  for (var i = 0; i < og_array.length; ++i) {
    var subArray = og_array[i];

    for (var ii = 0; ii < subArray.length; ++ii) {
      //console.log(currentCount, subArray[ii]);
      currentCount[ii] += subArray[ii];
      copyArray[i][ii] = currentCount[ii];

    }
    //console.log(currentCount);
  }
  return copyArray;
}

function processMediaData(mediaData) {
  mediaData.forEach(function(d, i) {
    var date = d.created_at; // fix date format
    d.created_at = new Date(date);

    d.outlet = [];
    var outlet = d.outlet;

    // outlet
    var tweet = d.text.toLowerCase();
    var news_outlet;
    if (tweet.includes("cnn")) { // CNN
      cnnCount++;
      outlet.push("cnn");
    }
    if (tweet.includes("nbc") || tweet.includes("msnbc")) { //NBC
      nbcCount++;
      outlet.push("nbc");
    }
    if (tweet.includes("washington post") || tweet.includes("washingtonpost") || tweet.includes("wapo")) { // WASHINGTON POST
      wapoCount++;
      outlet.push("washingtonpost");
    }
    if (tweet.includes("nytimes") || tweet.includes("new york times")) { // NYTIMES
      nytCount++;
      outlet.push("nyt");
    }
    if (tweet.includes("fox")) { // FOX
      foxCount++;
      outlet.push("fox");
    }
    if (tweet.includes("breitbart")) { // BREITBART
      breitCount++;
      outlet.push("breitbart");
    }

    if (outlet.length == 0) {
      miscCount++;
      outlet.push("misc");
    }

    d.is_fakeNews = false;

    // fake news or just news
    if (tweet.includes("fake") || tweet.includes("dishonest") || tweet.includes("fake")) { // CNN
      fakeNews++;
      d.is_fakeNews = true;
    } else {
      notFake++;
    }

    // label by month and year
    var m = d.created_at.getMonth();
    var y = d.created_at.getFullYear();
    if (y!=2015) {
      m = m + (12*(y-2015));
    }
    d.month = m - 5;
  })

  outletsByMonth(mediaData); //month_outlet
  fakeness(mediaData); // month_fake
  fakeOutlets(mediaData); //month_fake_outlets
  //notFakeOutlets(mediaData); // month_notfake_outlets

}

/***************** Graph 1 & Graph 2: Tweet Plot *******************/
// all times on the y-axis are relative to midnight for scatterplots
var midnight = new Date();
midnight.setHours(0, 0, 0, 0);
midnight = midnight.getTime();
var dayInMill = 86400000

// y-scale - based off the hours, minutes, seconds of tweet throught 24 hours
var yScale = d3.scaleTime()
  .domain([midnight, midnight + dayInMill - 1])
  .nice(d3.timeDay, 1)
  .rangeRound([padding, height - paddingBottom]);

// extracts the hours/minutes/seconds from the tweet's created by date
function getTime(date){
   return midnight +
          (date.getHours() * 60 * 60 * 1000) +
          (date.getMinutes() * 60 * 1000) +
          (date.getSeconds() * 1000);
}

/**
 * draws the circles on the scatterplot graphs
 * @param  {svg}  svgV    [the svg to draw the circles on]
 * @param  {scale}  xScale  [the x scale used]
 * @param  {scale}  yScale  [the y scale used]
 * @param  {list}  data    [the data that contains the times for each point]
 * @param  {float}  scale   [the scale of which to draw the circles at]
 * @param  {Boolean} isMedia [if this is the graph that relates to media]
 */
function drawCircles(svgV, xScale, yScale, data, scale, isMedia){
  data.forEach(function(d){
    var opacity = 0.6;
    var color = "rgb(208, 211, 212)"
    color = isMedia ? (d.is_media ? "rgb(40, 116, 166)" : color) : "rgb(40, 116, 166)"
    opacity = isMedia ? (d.is_media ? opacity : 0.5) : opacity
    svgV.append("circle")
      .attr("r", 3*scale)
      .attr("opacity", opacity)
      .attr("fill", color)
      .attr("cx", xScale(d.created_at))
      .attr("cy", yScale(getTime(d.created_at)))
  })
}

/**
 * builds the two scatterplots
 */
function buildScatterplots(){
  // sorry for indexing by 1 my b
  for (var i = 1; i < 3; i++) {
    // create the svgs
    var vis = d3.select("#div" + i)
    vis.append("svg")
      .attr("id", "graph" + i)
      .attr("width", width)
      .attr("height", height);
    var svg = d3.select("#graph" + i)
    svg.append("rect")
      .attr("width", width)
      .attr("height", height)
      .attr("x", 0)
      .attr("y", 0)
      .attr("fill","rgb(232,245,253)");

    // create xAxis
    var xAxis = d3.axisBottom(xScale);
    svg.append("g")
      .attr("class", "xAxis")
      .attr("transform", "translate(0," + (height - paddingBottom) + ")")
      .call(xAxis
        .tickFormat(d3.timeFormat('%b'))
        .tickSize(0))
      .selectAll("text").remove()

    // only for the first graph, append fox & friends label and 2016 election label
    if (i == 1) {
      svg.append("text")
        .text("fox & friends")
        .style("font-size", 12)
        .style("font-style", "italic")
        .attr("x", width - paddingSides+15)
        .attr("text-bottom", "middle")
        .attr("y", 150);
      svg.append("text")
        .text("time slot")
        .style("font-size", 12)
        .style("font-style", "italic")
        .attr("x", width - paddingSides + 25)
        .attr("text-bottom", "middle")
        .attr("y", 165);
      var foxStartTime = new Date()
      foxStartTime.setHours(6,0,0)
      var foxEndTime = new Date()
      foxEndTime.setHours(9,0,0)

      svg.append("text")
        .attr("x", paddingSides)
        .attr("y", (yScale(getTime(foxEndTime)) - yScale(getTime(foxStartTime)))/2)
        // .attr("fill", "rgb(72,201,176)")
        .style("font-size", 12)
        .text("]")

      var path =
        "M "
        + (width - paddingSides)
        + " "
        + yScale(getTime(foxStartTime))
        + " H "
        + (width - paddingSides + 10)
        + " V "
        + yScale(getTime(foxEndTime))
        // + (yScale(getTime(foxEndTime)) - yScale(getTime(foxStartTime)))
        + " L "
        + (width - paddingSides)
        + " "
        + yScale(getTime(foxEndTime))
        console.log(path)
      svg.append("path")
        .attr("d", path)
        .attr("fill", "none")
        .attr("stroke", "black")
        .attr("stroke-width", 3)


      svg.append("rect")
        .attr("id","electionLabelHighlight")
        .attr("fill", linecolor)
        .attr("stroke", linecolor)
        .attr("stroke-width",3)
        .attr("width", 250)
        .attr("height", 22)
        .attr("opacity", 0.7)
        .attr("x", xScale(electionDay)-131)
        .attr("y", height - paddingBottom + padding);
    }

    // create the y-axis
    var yAxis = d3.axisLeft(yScale);
    svg.append("g")
      .attr("class", "axis")
      .style("font-size", 10)
      .style("font-family","Consolas,monaco,monospace")
      .attr("transform", "translate(" + paddingSides + ", 0)")
      .call(yAxis
        .tickFormat(d3.timeFormat('%I:%M:%p'))
        .tickSize(0)
        .tickPadding(8))

    // y-axis label
    svg.append("text")
      .text("time of day tweeted")
      .style("font-size", 16)
      .style("font-family", "Open Sans")
      .style("font-weight", 700)
      .style("letter-spacing", 3)
      .attr("transform", "rotate(-90)")
      .attr("x",-350)
      .attr("y",120);

    // populate the graph
    drawCircles(svg, xScale, yScale, rawData, 1, i === 2);
    drawLines(svg, height, paddingBottom, xScale, 0.8, i == 1);

    // overlay the election line on top
    svg.append("line")
      .attr("id", "#electionline")
      .attr("stroke-width", 3)
      .attr("stroke", linecolor)
      .attr("opacity", 0.7)
      .attr("x1", xScale(electionDay))
      .attr("x2", xScale(electionDay))
      .attr("y1", height)
      .attr("y2", 0);

    //labels

    // tweet label on first graph
    //logo from https://about.twitter.com/en_us/company/brand-resources.html
    d3.select("#graph1")
      .append('svg:image')
      .attr('xlink:href', 'resources/twitterlogo.png')
      .attr("x",900)
      .attr("y",20)
      .attr("width",25)
      .attr("height",25);


    d3.select("#graph1")
      .append("line")
      .attr("stroke-width", 1)
      .attr("stroke", "black")
      .attr("x1",820)
      .attr("y1", 90)
      .attr("x2",900)
      .attr("y2", 40);

    d3.select("#graph1")
      .append("text")
      .text("Tweet")
      .style("font-size", 12)
      .style("font-weight", 100)
      .attr("x",925)
      .attr("y",35);

    // key for second graph
    d3.select("#graph2")
      .append("circle")
      .attr("r", 3)
      .attr("fill", "black")
      .attr("cx",width - paddingSides + 30)
      .attr("cy",275)
      .attr("opacity",0.6)
      .attr("stroke","black")
      .attr("fill","rgb(208, 211, 212)");

    d3.select("#graph2")
      .append("text")
      .attr("id","legend")
      .attr("x", width - paddingSides + 40)
      .attr("y", 280)
      .text("General Tweet")
      .style("font-size", 14)
      .style("font-weight", 100);

    d3.select("#graph2")
      .append("circle")
      .attr("r", 3)
      .attr("fill", "black")
      .attr("cx",width - paddingSides + 30)
      .attr("cy",295)
      .attr("opacity",0.6)
      .attr("stroke","black")
      .attr("fill","rgb(40, 116, 166)")

    d3.select("#graph2")
      .append("text")
      .attr("x", width - paddingSides + 40)
      .attr("y", 300)
      .text("Tweet referencing")
      .style("font-size", 14)
      .style("font-weight", 100);

    d3.select("#graph2")
      .append("text")
      .attr("x", width - paddingSides + 40)
      .attr("y", 320)
      .text("Media")
      .style("font-size", 14)
      .style("font-weight", 100);
  }
}

/***************** Graph 3: Tweet Media Outlets  *******************/
// var outlets = ["washingtonpost":1, "nyt":2, "nbc":3, "cnn":4, "fox":5, "misc":6]
var outletColors = ["#D6EAF8","#B0C4DE","#5DADE2","#2874A6","#1A5276","rgb(232,245,253)"];
var outletIndex = [0,1,2,3,4,5];

/** The X-Axis code for scale and axis */
var monthScale = xScale;
var monthAxis = d3.axisBottom(monthScale);
var percentageScale = d3.scaleLinear()
    .domain([0,1])
    .rangeRound([height - paddingBottom, padding]);
var percentageAxis = d3.axisLeft(percentageScale);
var area = d3.area()
  .x(function(d, i) { i+=5; return xScale(new Date(Math.floor(2015 + i/12), i%12, 15)) })
  .y0(function(d) { return percentageScale(d[0]); })
  .y1(function(d) { return percentageScale(d[1]); });

var stack = d3.stack()
  .keys(outletIndex)
var z = d3.scaleOrdinal(d3.schemeCategory10);
z.domain(outletIndex).range(outletColors)

function createNewsOutletGraph(data){
  // draw SVG set-up
  var graph = d3.select("#div3");
  graph.append("svg")
  .attr("id","graph3")
  .attr("width", width)
  .attr("height", height);

  var svg2 = d3.select("#graph3");
  svg2.append("rect")
  .attr("width", width)
  .attr("height", height)
  .attr("x", 0)
  .attr("y", 0)
  .attr("fill","rgb(232,245,253)");

  svg2.append("g")
  .attr("class", "axis")
  .style("font-size", 14)
  .style("font-weight", "bold")
  .style("font-family","Consolas,monaco,monospace")
  .attr("transform", "translate(0," + (height - paddingBottom) + ")")
  .call(monthAxis
  .tickFormat(d3.timeFormat('%b')));
  /** The Y-Axis code for scale and axis */
  svg2.append("g")
  .attr("class", "axis")
  .style("font-size", 10)
  .style("font-family","Consolas,monaco,monospace")
  .attr("transform", "translate(" + paddingSides + ", 0)")
  .call(percentageAxis
  .tickFormat(d3.format(".0%"))
  .tickSize(0)
  .tickPadding(8));

  var g = svg2.append("g")
  var layer = g.selectAll(".layer")
    .data(stack(data))
    .enter().append("g")
    .attr("class", "layer");

layer.append("path")
    .attr("class", "area")
    .style("fill", function(d, i) { return z(d.key); })
    .attr("d", area);
     var newsNames= ["Washington Post", "New York Times", "NBC", "CNN", "Fox", ""];

//axis labels
 svg2.append("text")
   .text("% of Cumulative Mentions")
   .style("font-size", 16)
   .style("font-family", "Open Sans")
   .style("font-weight", 700)
   .style("letter-spacing", 3)
   .attr("transform", "rotate(-90)")
   .attr("x",-350)
   .attr("y",120);

 var axisyears=[2016,2017,2018];
 axisyears.forEach(function(d,i){
   svg2.append("text")
   .attr("x", i*258+328)
   .attr("y", 440)
   .text(axisyears[i])
   .style("font-size", 12)
   .style("font-weight", 100);
 })
//key
  newsNames.forEach(function(d,i){
    svg2.append("text")
    .attr("x", width - paddingSides + 40)
    .attr("y", 360-20*i)
    .text(newsNames[i])
    .style("font-size", 14)
    .style("font-weight", 100);
  })

  for (i = 0; i < 5; i++){
    svg2.append("rect")
    .attr("height", 7)
    .attr("width", 7)
    .attr("fill", z(i))
    .attr("stroke","black")
    .attr("x",width - paddingSides + 20)
    .attr("y",355-20*i);
  }

  svg2.append("line")
    .attr("id", "#electionline")
    .attr("stroke-width", 3)
    .attr("stroke", linecolor)
    .attr("opacity", 0.7)
    .attr("x1", xScale(electionDay))
    .attr("x2", xScale(electionDay))
    .attr("y1", height)
    .attr("y2", 0);

}

/***************** Graph 4: Area Fake/Not Fake   *******************/
function createFakeNewsAreaGraph(data){
  // draw SVG set-up
  var graph = d3.select("#div4");
  graph.append("svg")
  .attr("id","graph4")
  .attr("width", width)
  .attr("height", height);

  var svg2 = d3.select("#graph4");
  svg2.append("rect")
  .attr("width", width)
  .attr("height", height)
  .attr("x", 0)
  .attr("y", 0)
  .attr("fill","rgb(232,245,253)");

  svg2.append("g")
  .attr("class", "axis")
  .style("font-size", 14)
  .style("font-weight", "bold")
  .style("font-family","Consolas,monaco,monospace")
  .attr("transform", "translate(0," + (height - paddingBottom) + ")")
  .call(monthAxis
  .tickFormat(d3.timeFormat('%b')));
  /** The Y-Axis code for scale and axis */
  svg2.append("g")
  .attr("class", "axis")
  .style("font-size", 10)
  .style("font-family","Consolas,monaco,monospace")
  .attr("transform", "translate(" + paddingSides + ", 0)")
  .call(percentageAxis
  .tickFormat(d3.format(".0%"))
  .tickSize(0)
  .tickPadding(8));

  var g = svg2.append("g")
  var layer = g.selectAll(".layer")
    .data(stack(data))
    .enter().append("g")
    .attr("class", "layer");

  layer.append("path")
      .attr("class", "area")
      .style("fill", function(d, i) { return z(d.key); })
      .attr("d", area);

//graph labels
  svg2.append("text")
    .attr("x", 640)
    .attr("y", 100)
    .text("Did not mention Fake News")
    .style("font-size", 14)
    .style("font-weight", 100);

  svg2.append("text")
    .attr("x", 740)
    .attr("y", 325)
    .text("Fake News")
    .style("font-size", 14)
    .style("font-weight", 100);

//axis labels
svg2.append("text")
  .text("% of Mentions")
  .style("font-size", 16)
  .style("font-family", "Open Sans")
  .style("font-weight", 700)
  .style("letter-spacing", 3)
  .attr("transform", "rotate(-90)")
  .attr("x",-300)
  .attr("y",120);

var axisyears=[2016,2017,2018]
axisyears.forEach(function(d,i){
  svg2.append("text")
  .attr("x", i*258+328)
  .attr("y", 440)
  .text(axisyears[i])
  .style("font-size", 12)
  .style("font-weight", 100);
})

  svg2.append("line")
    .attr("id", "#electionline")
    .attr("stroke-width", 3)
    .attr("stroke", linecolor)
    .attr("opacity", 0.7)
    .attr("x1", xScale(electionDay))
    .attr("x2", xScale(electionDay))
    .attr("y1", height)
    .attr("y2", 0);

}

/***************** Graph 5: Trump's Fakest Media *******************/
var div5 = d3.select("#div5");
div5.append("svg")
  .attr("id","graph5")
  .attr("width", width)
  .attr("height", height*2);

var svg5 = d3.select("#graph5");

//graph labels
/* cnn : 44 / 235 --> 0.18723404255
fox : 15 / 354 --> 0.04237288135
nbc : 32 / 116 --> 0.27586206896
nyt : 24 / 115 --> 0.20869565217
washingtonpost : 12 / 50 --> 0.24

fakeNews / not Fake = 272 / 1087 --> 0.25
*/
//put in corresponding order
var labels = ["NBC","Washington Post","New York Times","CNN","Fox"];
var fakecounts = [32,12,24,44,15];
var ttlcounts = [115,50,116,235,354];

var mediaMentionCount = 0; //870
for (var i=0; i < labels.length; i++) {
	mediaMentionCount += ttlcounts[i]
};

var group5 = svg5.append("g");

var prevH = 100;

//labels
svg5.append("rect")
	.attr("x", xScale(electionDay)-95)
	.attr("y", prevH-70)
	.attr("height",30)
	.attr("width",60)
	.attr("fill","#D6EAF8")
	.attr("stroke-width","0.5")
	.attr("stroke","grey");

svg5.append("rect")
	.text("/")
	.attr("x", xScale(electionDay)-10)
	.attr("y", prevH-70)
	.attr("height",30)
	.attr("width",110)
	.attr("fill","#B0C4DE")
	.attr("stroke-width","0.5")
	.attr("stroke","grey");

svg5.append("text")
	.text("( FAKE / NOT FAKE )")
	.attr("x", xScale(electionDay))
	.attr("y", prevH-50)
	.style("font-size", 20)
	.style("font-weight", 800)
	.style("text-anchor","middle");

// make waffle charts of percentages
for (var i=0; i < labels.length; i++) {
	var g = group5.append("g").attr("id","#g"+(i+1));
	makeWaffle(ttlcounts[i],fakecounts[i],g,xScale(electionDay)-250,prevH);
	prevH += (Math.ceil(ttlcounts[i]/25)*20) +20;

	var numRows = Math.ceil(ttlcounts[i]/25);
	var y_move = (numRows*10);

	svg5.append("text")
		.attr("x", xScale(electionDay)-280)
		.attr("y", prevH-y_move)
		.text("#" + (i+1) + ".) " + labels[i])
		.style("font-size", 20)
		.style("font-weight", 100)
		.style("text-anchor","end");

	svg5.append("text")
		.attr("x", xScale(electionDay)+270)
		.attr("y", prevH-y_move)
		.text(ttlcounts[i] + " tweets, " + Math.round(((fakecounts[i]/ttlcounts[i])*100)) + "% fake")
		.style("font-size", 20)
		.style("font-weight", 100);
};

function makeWaffle(totalCount,count1,svg_group,x,y) {
	var percent1 = count1/totalCount;
	var percent_formatted = Math.round(1000*percent1)/10;

	var squareSize = 20;
	var coordx = x;
	var coordy = y;

	for (var i = 1; i < totalCount + 1; i++) {
		svg_group.append("rect")
		.attr("height", squareSize)
		.attr("width", squareSize)
		.attr("fill", (i<count1) ? "#D6EAF8":"#B0C4DE")
		.attr("stroke-width","0.25")
		.attr("stroke","grey")
		.attr("x",coordx)
		.attr("y",coordy);

		if (i % 25 == 0) {
			coordx = x;
			coordy = coordy + squareSize;
		} else {
			coordx += squareSize;
		}
	}
}

/***************** RUN EVERYTHING *******************/
var rawData;
d3.queue()
.defer(d3.json, "data/data.json")
.defer(d3.json, "data/mediaData.json")
.await(callback);

var mediaData = '[';

// load and process all
function callback(err, data, medData) {
    rawData = data;

    rawData.forEach(function(d, i) {
      // convert the created_at date to JavaScript Dates
      var date = d.created_at;
      d.created_at = new Date(date);
      d.is_media = false;

      // scan tweets if they are media tweets
      for (var i = 0; i < media.length; i++) {
        var keyword = media[i];
        lowercased_text = d.text.toLowerCase();
        if(lowercased_text.includes(keyword)){
          d.is_media = true;
          mediaData += JSON.stringify(d) + ', ';
          break;
        }
      }

      // accumulate counts for percentages
      if (d.is_media == true) {
        mediaCount++;
      } else {
        notMediaCount++;
      }
    })

  mediaData = medData;
  processMediaData(mediaData);

  var outletPercentages_month = intoPercentages(month_outlet, 6);
  var fakeOutletPercentages_month = intoPercentages(month_fake, 2);


  /* CUMULATIVE VERSIONS */
  var monthly_outlets_cumul = toCumulative(month_outlet);
  var moc_percent = intoPercentages(monthly_outlets_cumul, 6);

  var monthly_fake_cumul = toCumulative(month_fake);
  var mfc_percent = intoPercentages(monthly_fake_cumul, 2)

  var monthly_fake_outlets_cumul = toCumulative(month_fake_outlets);
  var mfoc_percent = intoPercentages(monthly_fake_outlets_cumul, 6);


  buildScatterplots();
  createNewsOutletGraph(moc_percent)
  createFakeNewsAreaGraph(fakeOutletPercentages_month)
}
</script>
</div> <!-- end parallelx div-->
</body>
</html>
